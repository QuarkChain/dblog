# dBolg

## Introduction
dBlog is a decentralized blog based on the Web3Q chain. Anyone can write and publish blog posts in dBlog, 
and can also comment on any user's blog post.
   
The official home page of the dBlog project is https://web3q.io/dblog.w3q/.


## Structure
This project consists of three contracts, the blog.w3q for storing front-end web files, SimpleBlog for managing blogs, and SimpleComment for managing comments.

Since the front-end code, data and functions are all on the blockchain, the full decentralization of the project is achieved.

### dblog.w3q
[dblog.w3q](https://web3q.io/w3ns.w3q/#/domains/dblog.w3q) is a w3ns domain name, which maps a contract address, 
the contract is a FlatDirectory contract that stores dBlog's website files.

FlatDirectory is the implementation of the web3 storage data contract. Click [here](https://docs.web3q.io/tutorials/migrate-your-website-to-web3q-in-5-mins) for details.


#### Deploy SimpleBlog
Before users start blogging, they need to deploy their own SimpleBlog contract.
```
const provider = new ethers.providers.Web3Provider(window.ethereum);
const receipt = await this._doTx(() =>
   // Deploy `SimpleBlog`
   provider.getSigner().sendTransaction({
       data: "0x60c06040819052600060a08190526200001b9160029162000101565b503480156200002957600080fd5b5060006080819052600380546001600160a01b031916331790556040518190620000539062000190565b60ff9091168152602001604051809103906000f0801580156200007a573d6000803e3d6000fd5b5060405163a6f9dae160e01b81523360048201529091506001600160a01b0382169063a6f9dae190602401600060405180830381600087803b158015620000c057600080fd5b505af1158015620000d5573d6000803e3d6000fd5b5050600780546001600160a01b0319166001600160a01b03949094169390931790925550620001f29050565b8280546200010f90620001b5565b90600052602060002090601f0160209004810192826200013357600085556200017e565b82601f106200014e57805160ff19168380011785556200017e565b828001600101855582156200017e579182015b828111156200017e57825182559160200191906001019062000161565b506200018c9291506200019e565b5090565b611f4e806200458a83390190565b5b808211156200018c57600081556001016200019f565b600181811c90821680620001ca57607f821691505b60208210811415620001ec57634e487b7160e01b600052602260045260246000fd5b50919050565b60805160f81c61437962000211600039600061191801526143796000f3fe608060405260043610620001a65760003560e01c80638da5cb5b11620000e5578063ba742b721162000097578063d4868baa116200006d578063d4868baa1462000631578063dc3c82281462000667578063dd473fae146200067e578063df41c3cf146200069a57620001a6565b8063ba742b7214620005c7578063bd666ab514620005de578063ce55f67314620005f557620001a6565b80638da5cb5b14620004e8578063a3dff135146200050a578063a5e0880d1462000533578063a6f9dae11462000558578063ae52575c146200057d578063af21c8b214620005a257620001a6565b80633ec67494116200015d57806363af2626116200013357806363af2626146200041657806371a97305146200043d57806380f052d8146200047857806386e107a214620004ad57620001a6565b80633ec67494146200036457806358edef4c14620003c8578063590e1ae314620003fe57620001a6565b8063038cd79f146200028357806309362861146200029c5780631c993ad514620002cc57806323edf69714620002f15780632b68b9c6146200032757806331a4bcb5146200033f575b348015620001b357600080fd5b5060006200025360028054620001c99062002539565b80601f0160208091040260200160405190810160405280929190818152602001828054620001f79062002539565b8015620002485780601f106200021c5761010080835404028352916020019162000248565b820191906000526020600020905b8154815290600101906020018083116200022a57829003601f168201915b5050505050620006cb565b90506000816040516020016200026a91906200238f565b6040516020818303038152906040529050805160208201f35b6200029a62000294366004620020f4565b620006f3565b005b348015620002a957600080fd5b50620002b46200074b565b604051620002c391906200238f565b60405180910390f35b348015620002d957600080fd5b506200029a620002eb36600462002035565b620007e1565b348015620002fe57600080fd5b50620003166200031036600462001ff8565b62000827565b604051620002c393929190620022d5565b3480156200033457600080fd5b506200029a62000bc2565b3480156200034c57600080fd5b506200029a6200035e36600462002012565b62000bfd565b3480156200037157600080fd5b50620003a86200038336600462001ff8565b600660205260009081526040902080546001909101546001600160a01b039091169082565b604080516001600160a01b039093168352602083019190915201620002c3565b348015620003d557600080fd5b50620003ed620003e736600462002035565b62000dbb565b6040519015158152602001620002c3565b3480156200040b57600080fd5b506200029a62000e0d565b3480156200042357600080fd5b506200042e60055481565b604051908152602001620002c3565b3480156200044a57600080fd5b506007546200045f906001600160a01b031681565b6040516001600160a01b039091168152602001620002c3565b3480156200048557600080fd5b506200049d6200049736600462001ff8565b62000e77565b604051620002c3929190620023a4565b348015620004ba57600080fd5b50620004d2620004cc36600462001ff8565b62000f3c565b60408051928352901515602083015201620002c3565b348015620004f557600080fd5b506003546200045f906001600160a01b031681565b3480156200051757600080fd5b506200052262000f9e565b604051620002c39392919062002350565b3480156200054057600080fd5b50620004d26200055236600462001ff8565b62001218565b3480156200056557600080fd5b506200029a6200057736600462001fb8565b62001281565b3480156200058a57600080fd5b50620002b46200059c36600462002035565b620006cb565b348015620005af57600080fd5b506200029a620005c136600462001ff8565b6200132f565b6200029a620005d8366004620020f4565b6200139f565b6200029a620005ef3660046200215e565b620014b7565b3480156200060257600080fd5b506200042e6200061436600462002012565b600160209081526000928352604080842090915290825290205481565b3480156200063e57600080fd5b50620006566200065036600462001ff8565b62001669565b604051620002c393929190620023c8565b6200029a620006783660046200219e565b62001787565b3480156200068b57600080fd5b50636175746f60e01b6200042e565b348015620006a757600080fd5b506200042e620006b936600462001ff8565b60006020819052908152604090205481565b60606000620006db836020015190565b90506000620006ea826200182d565b50949350505050565b6003546001600160a01b03163314620007295760405162461bcd60e51b81526004016200072090620023f7565b60405180910390fd5b600062000737836020015190565b9050620007468183346200188e565b505050565b600280546200075a9062002539565b80601f0160208091040260200160405190810160405280929190818152602001828054620007889062002539565b8015620007d95780601f10620007ad57610100808354040283529160200191620007d9565b820191906000526020600020905b815481529060010190602001808311620007bb57829003601f168201915b505050505081565b6003546001600160a01b031633146200080e5760405162461bcd60e51b81526004016200072090620023f7565b80516200082390600290602084019062001e9a565b5050565b6000818152600660205260409020805460609182918291906001600160a01b031680620008c0576040805160008082526020820181815282840190935290919062000883565b60608152602001906001900390816200086d5790505b506040805160008082526020820190925290620008b1565b60608152602001906001900390816200089b5790505b50945094509450505062000bbb565b6001820154806001600160401b03811115620008e057620008e0620025c0565b6040519080825280602002602001820160405280156200090a578160200160208202803683370190505b509550806001600160401b03811115620009285762000928620025c0565b6040519080825280602002602001820160405280156200095d57816020015b6060815260200190600190039081620009475790505b509450806001600160401b038111156200097b576200097b620025c0565b604051908082528060200260200182016040528015620009b057816020015b60608152602001906001900390816200099a5790505b5093508160005b8281101562000bb557604051632d8cd88360e21b8152600481018290526001600160a01b0383169063b633620c9060240160006040518083038186803b15801562000a0157600080fd5b505afa15801562000a16573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405262000a40919081019062002075565b87828151811062000a555762000a55620025aa565b602090810291909101015260405163620d1b0560e11b8152600481018290526001600160a01b0383169063c41a360a9060240160206040518083038186803b15801562000aa157600080fd5b505afa15801562000ab6573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000adc919062001fd8565b88828151811062000af15762000af1620025aa565b6001600160a01b039283166020918202929092010152604051620800e360e81b81526004810183905290831690630800e3009060240160006040518083038186803b15801562000b4057600080fd5b505afa15801562000b55573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405262000b7f919081019062002075565b86828151811062000b945762000b94620025aa565b6020026020010181905250808062000bac9062002576565b915050620009b7565b50505050505b9193909250565b6003546001600160a01b0316331462000bef5760405162461bcd60e51b81526004016200072090620023f7565b6003546001600160a01b0316ff5b600082815260066020526040902080546001600160a01b03168062000c565760405162461bcd60e51b815260206004820152600e60248201526d189b1bd9c81b9bdd08195e1a5cdd60921b604482015260640162000720565b60405163620d1b0560e11b81526004810184905281906000906001600160a01b0383169063c41a360a9060240160206040518083038186803b15801562000c9c57600080fd5b505afa15801562000cb1573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000cd7919062001fd8565b90506001600160a01b038116331462000d2b5760405162461bcd60e51b81526020600482015260156024820152744f6e6c79206f776e65722063616e2064656c65746560581b604482015260640162000720565b60018401546040516331a4bcb560e01b81526001600160a01b038416916331a4bcb59162000d66918991600401918252602082015260400190565b600060405180830381600087803b15801562000d8157600080fd5b505af115801562000d96573d6000803e3d6000fd5b5050506001850180549150600062000dae836200251f565b9190505550505050505050565b6003546000906001600160a01b0316331462000deb5760405162461bcd60e51b81526004016200072090620023f7565b600062000df9836020015190565b905062000e0681620019a3565b9392505050565b6003546001600160a01b0316331462000e3a5760405162461bcd60e51b81526004016200072090620023f7565b6003546040516001600160a01b03909116904780156108fc02916000818181858888f1935050505015801562000e74573d6000803e3d6000fd5b50565b6004818154811062000e8857600080fd5b906000526020600020906002020160009150905080600001805462000ead9062002539565b80601f016020809104026020016040519081016040528092919081815260200182805462000edb9062002539565b801562000f2c5780601f1062000f005761010080835404028352916020019162000f2c565b820191906000526020600020905b81548152906001019060200180831162000f0e57829003601f168201915b5050505050908060010154905082565b6000805b821562000f9357600462000f54846200251f565b9350838154811062000f6a5762000f6a620025aa565b90600052602060002090600202016001015460001462000f8d5750909160019150565b62000f40565b506000928392509050565b60608060606005546001600160401b0381111562000fc05762000fc0620025c0565b60405190808252806020026020018201604052801562000ff557816020015b606081526020019060019003908162000fdf5790505b5092506005546001600160401b03811115620010155762001015620025c0565b6040519080825280602002602001820160405280156200103f578160200160208202803683370190505b5091506005546001600160401b038111156200105f576200105f620025c0565b60405190808252806020026020018201604052801562001089578160200160208202803683370190505b5090506000805b6004548110156200121157600060048281548110620010b357620010b3620025aa565b9060005260206000209060020201604051806040016040529081600082018054620010de9062002539565b80601f01602080910402602001604051908101604052809291908181526020018280546200110c9062002539565b80156200115d5780601f1062001131576101008083540402835291602001916200115d565b820191906000526020600020905b8154815290600101906020018083116200113f57829003601f168201915b5050505050815260200160018201548152505090508060200151600014620011fb578060000151868481518110620011995762001199620025aa565b60200260200101819052508060200151858481518110620011be57620011be620025aa565b60200260200101818152505081848481518110620011e057620011e0620025aa565b602090810291909101015282620011f78162002576565b9350505b5080620012088162002576565b91505062001090565b5050909192565b6000805b6004546200122d90600190620024d6565b83101562000f93576004620012428462002576565b93508381548110620012585762001258620025aa565b9060005260206000209060020201600101546000146200127b5750909160019150565b6200121c565b6003546001600160a01b03163314620012d35760405162461bcd60e51b815260206004820152601360248201527221b0b63632b91034b9903737ba1037bbb732b960691b604482015260640162000720565b6003546040516001600160a01b038084169216907f342827c97908e5e2f71151c08502a66d44b6f758e3ac2f1de95f02eb95f0a73590600090a3600380546001600160a01b0319166001600160a01b0392909216919091179055565b600060048281548110620013475762001347620025aa565b6000918252602082206001600290920201019190915560058054916200136d836200251f565b919050555062000823816040516020016200138a91815260200190565b60405160208183030381529060405262000dbb565b6004805460408051808201909152848152426020808301919091526001830184556000939093528051805192939192600285027f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19b01926200140592849291019062001e9a565b506020919091015160019091015560058054906000620014258362002576565b919050555062001458816040516020016200144291815260200190565b60405160208183030381529060405283620006f3565b6000818152600660205260408082209051909190620014779062001f29565b604051809103906000f08015801562001494573d6000803e3d6000fd5b5082546001600160a01b0319166001600160a01b03919091161790915550505050565b600082815260066020526040902080546001600160a01b031680620015105760405162461bcd60e51b815260206004820152600e60248201526d189b1bd9c81b9bdd08195e1a5cdd60921b604482015260640162000720565b600182015460405163bd666ab560e01b815282916001600160a01b0383169163bd666ab5916200154591889060040162002420565b600060405180830381600087803b1580156200156057600080fd5b505af115801562001575573d6000803e3d6000fd5b505050506001830154604051631aa7bca560e21b815260048101919091523360248201526001600160a01b03821690636a9ef29490604401600060405180830381600087803b158015620015c857600080fd5b505af1158015620015dd573d6000803e3d6000fd5b505050506001830154604051632e489fcb60e01b815260048101919091524260248201526001600160a01b03821690632e489fcb90604401600060405180830381600087803b1580156200163057600080fd5b505af115801562001645573d6000803e3d6000fd5b505050600184018054915060006200165d8362002576565b91905055505050505050565b606060006060600060048581548110620016875762001687620025aa565b9060005260206000209060020201604051806040016040529081600082018054620016b29062002539565b80601f0160208091040260200160405190810160405280929190818152602001828054620016e09062002539565b8015620017315780601f10620017055761010080835404028352916020019162001731565b820191906000526020600020905b8154815290600101906020018083116200171357829003601f168201915b50505050508152602001600182015481525050905062001773856040516020016200175e91815260200190565b604051602081830303815290604052620006cb565b815160209092015191969195509350915050565b6000600484815481106200179f576200179f620025aa565b90600052602060002090600202019050806001015460001415620017f55760405162461bcd60e51b815260206004820152600c60248201526b1b9bdb8b595e1a5cdd195b9d60a21b604482015260640162000720565b825162001809908290602086019062001e9a565b50426001820155604080516020810186905262001827910162001442565b50505050565b600081815260208190526040812054606091906200184b8162001a50565b15620018775760008481526001602052604081206200186b908362001a65565b95600195509350505050565b80620018838162001b0c565b935093505050915091565b600083815260208190526040902054620018a88162001a50565b6200191657806001600160a01b038116156200191457806001600160a01b0316632b68b9c66040518163ffffffff1660e01b8152600401600060405180830381600087803b158015620018fa57600080fd5b505af11580156200190f573d6000803e3d6000fd5b505050505b505b7f000000000000000000000000000000000000000000000000000000000000000060ff168351111562001974576200195f62001953848462001bc5565b6001600160a01b031690565b60008581526020819052604090205562001827565b60008481526001602052604090206200198e908462001ca4565b60008581526020819052604090205550505050565b60008181526020819052604081205480620019c15750600092915050565b620019cc8162001a50565b62001a3a57806001600160a01b0381161562001a3857806001600160a01b0316632b68b9c66040518163ffffffff1660e01b8152600401600060405180830381600087803b15801562001a1e57600080fd5b505af115801562001a33573d6000803e3d6000fd5b505050505b505b5050600090815260208190526040812055600190565b60008062001a5e8360e01c90565b1192915050565b6060600062001a748362001d3e565b92509050601c81111562001b0557603c82016000805b6020600162001a9b601c87620024d6565b62001aa890602062002498565b62001ab49190620024d6565b62001ac09190620024b3565b81101562001b015760008181526020888152604090912054808552925062001aea90849062002498565b92508062001af88162002576565b91505062001a8a565b5050505b5092915050565b6060600080600062001b1e8562001da9565b915091508062001b435750506040805160008082526020820190925294909350915050565b6000826001600160401b0381111562001b605762001b60620025c0565b6040519080825280601f01601f19166020018201604052801562001b8b576020820181803683370190505b509050600060405180610160016040528061012681526020016200421e6101269139519050838160208401893c5095600195509350505050565b60008060405180610160016040528061012681526020016200421e6101269139805185519192509060009062001bfc908362002498565b808452601f19603f8201168401604052905062001c2f60208701836020860162001c27919062002498565b885162001e0f565b600062001c3f6043602062002498565b3085820152905062001c54608c602062002498565b90503081850152506000858460405162001c6e9062001f37565b62001c7a91906200238f565b6040518091039082f090508015801562001c98573d6000803e3d6000fd5b50979650505050505050565b805160208083015160e083901b911c1790601c81111562001b05576000603c8401815b6020600162001cd8601c87620024d6565b62001ce590602062002498565b62001cf19190620024d6565b62001cfd9190620024b3565b81101562001b01578151925062001d1682602062002498565b600082815260208990526040902084905591508062001d358162002576565b91505062001cc7565b6000606062001d4d8360e01c90565b9150602083901b9250816001600160401b0381111562001d715762001d71620025c0565b6040519080825280601f01601f19166020018201604052801562001d9c576020820181803683370190505b5060208101939093525091565b6000806001600160a01b03831662001dc657506000928392509050565b60008060405180610160016040528061012681526020016200421e6101269139519050843b91508082101562001e03575060009485945092505050565b6200186b8183620024d6565b62001e1b818462002498565b925062001e29818362002498565b91505b6020811062001e6c5762001e42602083620024d6565b915062001e51602084620024d6565b80518352925062001e64602082620024d6565b905062001e2c565b8062001e7757505050565b62001e838184620024d6565b925062001e918183620024d6565b92519092525050565b82805462001ea89062002539565b90600052602060002090601f01602090048101928262001ecc576000855562001f17565b82601f1062001ee757805160ff191683800117855562001f17565b8280016001018555821562001f17579182015b8281111562001f1757825182559160200191906001019062001efa565b5062001f2592915062001f45565b5090565b611b2080620025ed83390190565b610111806200410d83390190565b5b8082111562001f25576000815560010162001f46565b600082601f83011262001f6e57600080fd5b813562001f8562001f7f826200246e565b6200243b565b81815284602083860101111562001f9b57600080fd5b816020850160208301376000918101602001919091529392505050565b60006020828403121562001fcb57600080fd5b813562000e0681620025d6565b60006020828403121562001feb57600080fd5b815162000e0681620025d6565b6000602082840312156200200b57600080fd5b5035919050565b600080604083850312156200202657600080fd5b50508035926020909101359150565b6000602082840312156200204857600080fd5b81356001600160401b038111156200205f57600080fd5b6200206d8482850162001f5c565b949350505050565b6000602082840312156200208857600080fd5b81516001600160401b038111156200209f57600080fd5b8201601f81018413620020b157600080fd5b8051620020c262001f7f826200246e565b818152856020838501011115620020d857600080fd5b620020eb826020830160208601620024f0565b95945050505050565b600080604083850312156200210857600080fd5b82356001600160401b03808211156200212057600080fd5b6200212e8683870162001f5c565b935060208501359150808211156200214557600080fd5b50620021548582860162001f5c565b9150509250929050565b600080604083850312156200217257600080fd5b8235915060208301356001600160401b038111156200219057600080fd5b620021548582860162001f5c565b600080600060608486031215620021b457600080fd5b8335925060208401356001600160401b0380821115620021d357600080fd5b620021e18783880162001f5c565b93506040860135915080821115620021f857600080fd5b50620022078682870162001f5c565b9150509250925092565b600081518084526020808501808196508360051b8101915082860160005b858110156200225d5782840389526200224a848351620022a7565b988501989350908401906001016200222f565b5091979650505050505050565b600081518084526020808501945080840160005b838110156200229c578151875295820195908201906001016200227e565b509495945050505050565b60008151808452620022c1816020860160208601620024f0565b601f01601f19169290920160200192915050565b606080825284519082018190526000906020906080840190828801845b82811015620023195781516001600160a01b031684529284019290840190600101620022f2565b505050838103828501526200232f818762002211565b915050828103604084015262002346818562002211565b9695505050505050565b60608152600062002365606083018662002211565b82810360208401526200237981866200226a565b905082810360408401526200234681856200226a565b60208152600062000e066020830184620022a7565b604081526000620023b96040830185620022a7565b90508260208301529392505050565b606081526000620023dd6060830186620022a7565b8460208401528281036040840152620023468185620022a7565b6020808252600f908201526e36bab9ba10333937b69037bbb732b960891b604082015260600190565b8281526040602082015260006200206d6040830184620022a7565b604051601f8201601f191681016001600160401b0381118282101715620024665762002466620025c0565b604052919050565b60006001600160401b038211156200248a576200248a620025c0565b50601f01601f191660200190565b60008219821115620024ae57620024ae62002594565b500190565b600082620024d157634e487b7160e01b600052601260045260246000fd5b500490565b600082821015620024eb57620024eb62002594565b500390565b60005b838110156200250d578181015183820152602001620024f3565b83811115620018275750506000910152565b60008162002531576200253162002594565b506000190190565b600181811c908216806200254e57607f821691505b602082108114156200257057634e487b7160e01b600052602260045260246000fd5b50919050565b60006000198214156200258d576200258d62002594565b5060010190565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052604160045260246000fd5b6001600160a01b038116811462000e7457600080fdfe60c06040819052600060a08190526200001b9160029162000047565b503480156200002957600080fd5b506000608052600380546001600160a01b031916331790556200012a565b8280546200005590620000ed565b90600052602060002090601f016020900481019282620000795760008555620000c4565b82601f106200009457805160ff1916838001178555620000c4565b82800160010185558215620000c4579182015b82811115620000c4578251825591602001919060010190620000a7565b50620000d2929150620000d6565b5090565b5b80821115620000d25760008155600101620000d7565b600181811c908216806200010257607f821691505b602082108114156200012457634e487b7160e01b600052602260045260246000fd5b50919050565b60805160f81c6119d7620001496000396000610b5c01526119d76000f3fe6080604052600436106200012e5760003560e01c80636a9ef29411620000af578063bd666ab5116200006d578063bd666ab51462000401578063c41a360a1462000418578063ce55f673146200043d578063dd473fae1462000488578063df41c3cf14620004a4576200012e565b80636a9ef29414620003405780638da5cb5b1462000357578063a6f9dae11462000392578063ae52575c14620003b7578063b633620c14620003dc576200012e565b80632b68b9c611620000fd5780632b68b9c6146200029e5780632e489fcb14620002b657806331a4bcb514620002cd57806358edef4c14620002f2578063590e1ae31462000328576200012e565b8063038cd79f146200020b5780630800e30014620002245780630936286114620002615780631c993ad51462000279575b3480156200013b57600080fd5b506000620001db600280546200015190620016a0565b80601f01602080910402602001604051908101604052809291908181526020018280546200017f90620016a0565b8015620001d05780601f10620001a457610100808354040283529160200191620001d0565b820191906000526020600020905b815481529060010190602001808311620001b257829003601f168201915b5050505050620004d5565b9050600081604051602001620001f29190620015c7565b6040516020818303038152906040529050805160208201f35b620002226200021c36600462001465565b620004fd565b005b3480156200023157600080fd5b506200024962000243366004620013e7565b62000555565b604051620002589190620015c7565b60405180910390f35b3480156200026e57600080fd5b506200024962000593565b3480156200028657600080fd5b50620002226200029836600462001424565b62000629565b348015620002ab57600080fd5b50620002226200066f565b62000222620002c736600462001401565b620006aa565b348015620002da57600080fd5b5062000222620002ec36600462001401565b620006e5565b348015620002ff57600080fd5b50620003176200031136600462001424565b62000852565b604051901515815260200162000258565b3480156200033557600080fd5b5062000222620008a4565b6200022262000351366004620014d0565b6200090e565b3480156200036457600080fd5b5060035462000379906001600160a01b031681565b6040516001600160a01b03909116815260200162000258565b3480156200039f57600080fd5b5062000222620003b1366004620013c9565b6200095f565b348015620003c457600080fd5b5062000249620003d636600462001424565b620004d5565b348015620003e957600080fd5b5062000249620003fb366004620013e7565b62000a0d565b6200022262000412366004620014ff565b62000a30565b3480156200042557600080fd5b506200037962000437366004620013e7565b62000a3f565b3480156200044a57600080fd5b50620004796200045c36600462001401565b600160209081526000928352604080842090915290825290205481565b60405190815260200162000258565b3480156200049557600080fd5b50636175746f60e01b62000479565b348015620004b157600080fd5b5062000479620004c3366004620013e7565b60006020819052908152604090205481565b60606000620004e5836020015190565b90506000620004f48262000a71565b50949350505050565b6003546001600160a01b03163314620005335760405162461bcd60e51b81526004016200052a90620015fc565b60405180910390fd5b600062000541836020015190565b90506200055081833462000ad2565b505050565b60606200058d620005668362000be8565b6040516020016200057891906200159a565b604051602081830303815290604052620004d5565b92915050565b60028054620005a290620016a0565b80601f0160208091040260200160405190810160405280929190818152602001828054620005d090620016a0565b8015620006215780601f10620005f55761010080835404028352916020019162000621565b820191906000526020600020905b8154815290600101906020018083116200060357829003601f168201915b505050505081565b6003546001600160a01b03163314620006565760405162461bcd60e51b81526004016200052a90620015fc565b80516200066b90600290602084019062001263565b5050565b6003546001600160a01b031633146200069c5760405162461bcd60e51b81526004016200052a90620015fc565b6003546001600160a01b0316ff5b6200066b620006b98362000be8565b604051602001620006cb91906200156b565b6040516020818303038152906040526200021c8362000bf0565b6000620006f28262000be8565b60405160200162000704919062001540565b60405160208183030381529060405290506000620007228362000be8565b6040516020016200073491906200156b565b60405160208183030381529060405290506000620007528462000be8565b6040516020016200076491906200159a565b6040516020818303038152906040529050838514620008275760006200078a84620004d5565b9050620007c36200079b8762000be8565b604051602001620007ad919062001540565b60405160208183030381529060405282620004fd565b6000620007d084620004d5565b9050620007f3620007e18862000be8565b604051602001620007ad91906200156b565b60006200080084620004d5565b905062000823620008118962000be8565b604051602001620007ad91906200159a565b5050505b620008328362000852565b506200083e8262000852565b506200084a8162000852565b505050505050565b6003546000906001600160a01b03163314620008825760405162461bcd60e51b81526004016200052a90620015fc565b600062000890836020015190565b90506200089d8162000d6a565b9392505050565b6003546001600160a01b03163314620008d15760405162461bcd60e51b81526004016200052a90620015fc565b6003546040516001600160a01b03909116904780156108fc02916000818181858888f193505050501580156200090b573d6000803e3d6000fd5b50565b6200066b6200091d8362000be8565b6040516020016200092f919062001540565b60408051601f198184030181526001600160a01b038516600560a21b1860148401526034830190915290620004fd565b6003546001600160a01b03163314620009b15760405162461bcd60e51b815260206004820152601360248201527221b0b63632b91034b9903737ba1037bbb732b960691b60448201526064016200052a565b6003546040516001600160a01b038084169216907f342827c97908e5e2f71151c08502a66d44b6f758e3ac2f1de95f02eb95f0a73590600090a3600380546001600160a01b0319166001600160a01b0392909216919091179055565b60606200058d62000a1e8362000be8565b6040516020016200057891906200156b565b6200066b620008118362000be8565b60008062000a6362000a518462000be8565b60405160200162000578919062001540565b90506200089d816014015190565b6000818152602081905260408120546060919062000a8f8162000e17565b1562000abb57600084815260016020526040812062000aaf908362000e2c565b95600195509350505050565b8062000ac78162000ed3565b935093505050915091565b60008381526020819052604090205462000aec8162000e17565b62000b5a57806001600160a01b0381161562000b5857806001600160a01b0316632b68b9c66040518163ffffffff1660e01b8152600401600060405180830381600087803b15801562000b3e57600080fd5b505af115801562000b53573d6000803e3d6000fd5b505050505b505b7f000000000000000000000000000000000000000000000000000000000000000060ff168351111562000bb85762000ba362000b97848462000f8d565b6001600160a01b031690565b60008581526020819052604090205562000be2565b600084815260016020526040902062000bd290846200106c565b6000858152602081905260409020555b50505050565b60606200058d825b60408051606480825260a08201909252606091906000908260208201818036833701905050905060005b841562000c9157600062000c30600a87620016fb565b905062000c3f600a8762001640565b955062000c4e81603062001625565b60f81b838362000c5e81620016dd565b94508151811062000c735762000c736200173e565b60200101906001600160f81b031916908160001a9053505062000c1a565b600062000ca082600162001625565b67ffffffffffffffff81111562000cbb5762000cbb62001754565b6040519080825280601f01601f19166020018201604052801562000ce6576020820181803683370190505b50905060005b82811162000d60578362000d01828562001657565b8151811062000d145762000d146200173e565b602001015160f81c60f81b82828151811062000d345762000d346200173e565b60200101906001600160f81b031916908160001a9053508062000d5781620016dd565b91505062000cec565b5095945050505050565b6000818152602081905260408120548062000d885750600092915050565b62000d938162000e17565b62000e0157806001600160a01b0381161562000dff57806001600160a01b0316632b68b9c66040518163ffffffff1660e01b8152600401600060405180830381600087803b15801562000de557600080fd5b505af115801562000dfa573d6000803e3d6000fd5b505050505b505b5050600090815260208190526040812055600190565b60008062000e258360e01c90565b1192915050565b6060600062000e3b8362001106565b92509050601c81111562000ecc57603c82016000805b6020600162000e62601c8762001657565b62000e6f90602062001625565b62000e7b919062001657565b62000e87919062001640565b81101562000ec85760008181526020888152604090912054808552925062000eb190849062001625565b92508062000ebf81620016dd565b91505062000e51565b5050505b5092915050565b6060600080600062000ee58562001172565b915091508062000f0a5750506040805160008082526020820190925294909350915050565b60008267ffffffffffffffff81111562000f285762000f2862001754565b6040519080825280601f01601f19166020018201604052801562000f53576020820181803683370190505b509050600060405180610160016040528061012681526020016200187c6101269139519050838160208401893c5095600195509350505050565b60008060405180610160016040528061012681526020016200187c6101269139805185519192509060009062000fc4908362001625565b808452601f19603f8201168401604052905062000ff760208701836020860162000fef919062001625565b8851620011d8565b6000620010076043602062001625565b308582015290506200101c608c602062001625565b9050308185015250600085846040516200103690620012f2565b620010429190620015c7565b6040518091039082f090508015801562001060573d6000803e3d6000fd5b50979650505050505050565b805160208083015160e083901b911c1790601c81111562000ecc576000603c8401815b60206001620010a0601c8762001657565b620010ad90602062001625565b620010b9919062001657565b620010c5919062001640565b81101562000ec85781519250620010de82602062001625565b6000828152602089905260409020849055915080620010fd81620016dd565b9150506200108f565b60006060620011158360e01c90565b9150602083901b92508167ffffffffffffffff8111156200113a576200113a62001754565b6040519080825280601f01601f19166020018201604052801562001165576020820181803683370190505b5060208101939093525091565b6000806001600160a01b0383166200118f57506000928392509050565b60008060405180610160016040528061012681526020016200187c6101269139519050843b915080821015620011cc575060009485945092505050565b62000aaf818362001657565b620011e4818462001625565b9250620011f2818362001625565b91505b6020811062001235576200120b60208362001657565b91506200121a60208462001657565b8051835292506200122d60208262001657565b9050620011f5565b806200124057505050565b6200124c818462001657565b92506200125a818362001657565b92519092525050565b8280546200127190620016a0565b90600052602060002090601f016020900481019282620012955760008555620012e0565b82601f10620012b057805160ff1916838001178555620012e0565b82800160010185558215620012e0579182015b82811115620012e0578251825591602001919060010190620012c3565b50620012ee92915062001300565b5090565b610111806200176b83390190565b5b80821115620012ee576000815560010162001301565b80356001600160a01b03811681146200132f57600080fd5b919050565b600082601f8301126200134657600080fd5b813567ffffffffffffffff8082111562001364576200136462001754565b604051601f8301601f19908116603f011681019082821181831017156200138f576200138f62001754565b81604052838152866020858801011115620013a957600080fd5b836020870160208301376000602085830101528094505050505092915050565b600060208284031215620013dc57600080fd5b6200089d8262001317565b600060208284031215620013fa57600080fd5b5035919050565b600080604083850312156200141557600080fd5b50508035926020909101359150565b6000602082840312156200143757600080fd5b813567ffffffffffffffff8111156200144f57600080fd5b6200145d8482850162001334565b949350505050565b600080604083850312156200147957600080fd5b823567ffffffffffffffff808211156200149257600080fd5b620014a08683870162001334565b93506020850135915080821115620014b757600080fd5b50620014c68582860162001334565b9150509250929050565b60008060408385031215620014e457600080fd5b82359150620014f66020840162001317565b90509250929050565b600080604083850312156200151357600080fd5b82359150602083013567ffffffffffffffff8111156200153257600080fd5b620014c68582860162001334565b600082516200155481846020870162001671565b6437bbb732b960d91b920191825250600501919050565b600082516200157f81846020870162001671565b68074696d657374616d760bc1b920191825250600901919050565b60008251620015ae81846020870162001671565b6618dbdb5b595b9d60ca1b920191825250600701919050565b6020815260008251806020840152620015e881604085016020870162001671565b601f01601f19169190910160400192915050565b6020808252600f908201526e36bab9ba10333937b69037bbb732b960891b604082015260600190565b600082198211156200163b576200163b62001712565b500190565b60008262001652576200165262001728565b500490565b6000828210156200166c576200166c62001712565b500390565b60005b838110156200168e57818101518382015260200162001674565b8381111562000be25750506000910152565b600181811c90821680620016b557607f821691505b60208210811415620016d757634e487b7160e01b600052602260045260246000fd5b50919050565b6000600019821415620016f457620016f462001712565b5060010190565b6000826200170d576200170d62001728565b500690565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052601260045260246000fd5b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052604160045260246000fdfe60806040526040516101113803806101118339810160408190526100229161002b565b80518060208301f35b6000602080838503121561003e57600080fd5b82516001600160401b038082111561005557600080fd5b818501915085601f83011261006957600080fd5b81518181111561007b5761007b6100fa565b604051601f8201601f19908116603f011681019083821181831017156100a3576100a36100fa565b8160405282815288868487010111156100bb57600080fd5b600093505b828410156100dd57848401860151818501870152928501926100c0565b828411156100ee5760008684830101525b98975050505050505050565b634e487b7160e01b600052604160045260246000fdfe6080604052348015600f57600080fd5b506004361060325760003560e01c80632b68b9c61460375780638da5cb5b14603f575b600080fd5b603d6081565b005b60657f000000000000000000000000000000000000000000000000000000000000000081565b6040516001600160a01b03909116815260200160405180910390f35b336001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000161460ed5760405162461bcd60e51b815260206004820152600e60248201526d3737ba10333937b69037bbb732b960911b604482015260640160405180910390fd5b33fffea2646970667358221220fc66c9afb7cb2f6209ae28167cf26c6c06f86a82cbe3c56de99027979389a1be64736f6c63430008070033a26469706673582212209105188e69111102c3317abcc2456040054c0c9af3ddc2335449b2fb299046b764736f6c6343000807003360806040526040516101113803806101118339810160408190526100229161002b565b80518060208301f35b6000602080838503121561003e57600080fd5b82516001600160401b038082111561005557600080fd5b818501915085601f83011261006957600080fd5b81518181111561007b5761007b6100fa565b604051601f8201601f19908116603f011681019083821181831017156100a3576100a36100fa565b8160405282815288868487010111156100bb57600080fd5b600093505b828410156100dd57848401860151818501870152928501926100c0565b828411156100ee5760008684830101525b98975050505050505050565b634e487b7160e01b600052604160045260246000fdfe6080604052348015600f57600080fd5b506004361060325760003560e01c80632b68b9c61460375780638da5cb5b14603f575b600080fd5b603d6081565b005b60657f000000000000000000000000000000000000000000000000000000000000000081565b6040516001600160a01b03909116815260200160405180910390f35b336001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000161460ed5760405162461bcd60e51b815260206004820152600e60248201526d3737ba10333937b69037bbb732b960911b604482015260640160405180910390fd5b33fffea2646970667358221220fc66c9afb7cb2f6209ae28167cf26c6c06f86a82cbe3c56de99027979389a1be64736f6c63430008070033a2646970667358221220f3593bd241d5b22e2f1881f2d08e392dbd4c9af42db5b755ed73f1b52290682a64736f6c6343000807003360c06040819052600060a08190526200001b916003916200008e565b503480156200002957600080fd5b5060405162001f4e38038062001f4e8339810160408190526200004c9162000134565b60f81b7fff000000000000000000000000000000000000000000000000000000000000001660805260028054336001600160a01b03199091161790556200019d565b8280546200009c9062000160565b90600052602060002090601f016020900481019282620000c057600085556200010b565b82601f10620000db57805160ff19168380011785556200010b565b828001600101855582156200010b579182015b828111156200010b578251825591602001919060010190620000ee565b50620001199291506200011d565b5090565b5b808211156200011957600081556001016200011e565b6000602082840312156200014757600080fd5b815160ff811681146200015957600080fd5b9392505050565b600181811c908216806200017557607f821691505b602082108114156200019757634e487b7160e01b600052602260045260246000fd5b50919050565b60805160f81c611d8b620001c3600039600081816104040152610b650152611d8b6000f3fe6080604052600436106200012e5760003560e01c806358edef4c11620000af578063a6f9dae1116200006d578063a6f9dae114620004fc578063caf128361462000521578063d84eb56c146200055c578063dd473fae1462000581578063f916c5b0146200059f576200012e565b806358edef4c146200043a578063590e1ae3146200045f5780635ba1d9e514620004775780638bf4515c146200049c5780638da5cb5b14620004c1576200012e565b80631c993ad511620000fd5780631c993ad5146200036c5780632b68b9c6146200039157806342216bed14620003a9578063492c7b2a14620003dd5780634eed7cf114620003f4576200012e565b8063038cd79f14620002b35780630936286114620002cc5780631a7237e014620002fc5780631c5ee10c1462000331575b3480156200013b57600080fd5b50600036606080826200015f575050604080516020810190915260008152620002a8565b8383600081811062000175576200017562001af2565b9050013560f81c60f81b6001600160f81b031916602f60f81b14620001c157505060408051808201909152600e81526d0d2dcc6dee4e4cac6e840e0c2e8d60931b6020820152620002a8565b8383620001d060018262001a3e565b818110620001e257620001e262001af2565b9050013560f81c60f81b6001600160f81b031916602f60f81b1415620002495762000240620002158460018188620019d4565b60036040516020016200022b9392919062001893565b604051602081830303815290604052620005c4565b5090506200029b565b620002976200025c8460018188620019d4565b8080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250620005c492505050565b5090505b620002a681620005e3565b505b915050805190602001f35b620002ca620002c436600462001735565b62000624565b005b348015620002d957600080fd5b50620002e462000676565b604051620002f3919062001970565b60405180910390f35b3480156200030957600080fd5b50620003216200031b366004620017a5565b6200070c565b604051620002f392919062001985565b3480156200033e57600080fd5b506200035662000350366004620016f4565b6200072f565b60408051928352602083019190915201620002f3565b3480156200037957600080fd5b50620002ca6200038b366004620016f4565b62000744565b3480156200039e57600080fd5b50620002ca6200078a565b348015620003b657600080fd5b50620003ce620003c8366004620017a5565b620007c5565b604051908152602001620002f3565b620002ca620003ee366004620017ee565b620007e7565b3480156200040157600080fd5b507f000000000000000000000000000000000000000000000000000000000000000060ff1615155b6040519015158152602001620002f3565b3480156200044757600080fd5b50620003ce62000459366004620016f4565b62000830565b3480156200046c57600080fd5b50620002ca62000874565b3480156200048457600080fd5b506200042962000496366004620017a5565b620008de565b348015620004a957600080fd5b5062000321620004bb366004620016f4565b620005c4565b348015620004ce57600080fd5b50600254620004e3906001600160a01b031681565b6040516001600160a01b039091168152602001620002f3565b3480156200050957600080fd5b50620002ca6200051b366004620016c9565b62000928565b3480156200052e57600080fd5b506200054662000540366004620017a5565b62000977565b60408051928352901515602083015201620002f3565b3480156200056957600080fd5b50620003ce6200057b366004620017a5565b6200098d565b3480156200058e57600080fd5b50651b585b9d585b60d21b620003ce565b348015620005ac57600080fd5b50620003ce620005be366004620016f4565b620009d0565b60606000620005da8380519060200120620009e4565b91509150915091565b600081516040620005f5919062001a00565b9050601f196200060782602062001a00565b6200061490601f62001a00565b1690506020808303528060208303f35b6002546001600160a01b031633146200065a5760405162461bcd60e51b81526004016200065190620019ab565b60405180910390fd5b620006718380519060200120600084843462000b55565b505050565b60038054620006859062001a87565b80601f0160208091040260200160405190810160405280929190818152602001828054620006b39062001a87565b8015620007045780601f10620006d85761010080835404028352916020019162000704565b820191906000526020600020905b815481529060010190602001808311620006e657829003601f168201915b505050505081565b606060006200072384805190602001208462000c3f565b915091505b9250929050565b600080620005da838051906020012062000cb8565b6002546001600160a01b03163314620007715760405162461bcd60e51b81526004016200065190620019ab565b8051620007869060039060208401906200153b565b5050565b6002546001600160a01b03163314620007b75760405162461bcd60e51b81526004016200065190620019ab565b6002546001600160a01b0316ff5b600080620007d484846200070c565b5080516020909101209150505b92915050565b6002546001600160a01b03163314620008145760405162461bcd60e51b81526004016200065190620019ab565b6200082a84805190602001208484843462000b55565b50505050565b6002546000906001600160a01b03163314620008605760405162461bcd60e51b81526004016200065190620019ab565b620007e18280519060200120600062000d0f565b6002546001600160a01b03163314620008a15760405162461bcd60e51b81526004016200065190620019ab565b6002546040516001600160a01b03909116904780156108fc02916000818181858888f19350505050158015620008db573d6000803e3d6000fd5b50565b6002546000906001600160a01b031633146200090e5760405162461bcd60e51b81526004016200065190620019ab565b6200092183805190602001208362000dd7565b9392505050565b6002546001600160a01b03163314620009555760405162461bcd60e51b81526004016200065190620019ab565b600280546001600160a01b0319166001600160a01b0392909216919091179055565b6000806200072384805190602001208462000ec7565b6002546000906001600160a01b03163314620009bd5760405162461bcd60e51b81526004016200065190620019ab565b6200092183805190602001208362000d0f565b6000620007e1828051906020012062000f1f565b60606000806000620009f68562000cb8565b91509150806000141562000a3f5760005b6040519080825280601f01601f19166020018201604052801562000a32576020820181803683370190505b5095600095509350505050565b60008267ffffffffffffffff81111562000a5d5762000a5d62001b08565b6040519080825280601f01601f19166020018201604052801562000a88576020820181803683370190505b5090506020810160005b8381101562000b46576000888152602081815260408083208484529091528120549062000abf8262000f5e565b1562000b015762000ad08260e01c90565b60008b8152600160209081526040808320878452909152902090915062000af990838662000f73565b505062000b20565b8162000b0d8162001027565b50915062000b1c818662001099565b5050505b62000b2c818562001a00565b93505050808062000b3d9062001abe565b91505062000a92565b50909660019650945050505050565b62000b618585620010f8565b60ff7f00000000000000000000000000000000000000000000000000000000000000001682111562000bc85762000baa62000b9e84848462001210565b6001600160a01b031690565b60008681526020818152604080832088845290915290205562000c38565b60008581526001602090815260408083208784528252918290208251601f860183900483028101830190935284835262000c1f9290918690869081908401838280828437600092019190915250620012cc92505050565b6000868152602081815260408083208884529091529020555b5050505050565b6000828152602081815260408083208484529091528120546060919062000c668162000f5e565b1562000ca0576000858152600160209081526040808320878452909152812062000c91908362001371565b93506001925062000728915050565b8062000cac816200140d565b93509350505062000728565b6000806000805b60008062000cce878462000ec7565b915091508062000ce057505062000d05565b62000cec828562001a00565b93508262000cfa8162001abe565b935050505062000cbf565b9094909350915050565b60005b6000838152602081815260408083208584529091529020548062000d37575062000dd1565b62000d428162000f5e565b62000da3576000819050806001600160a01b0316632b68b9c66040518163ffffffff1660e01b8152600401600060405180830381600087803b15801562000d8857600080fd5b505af115801562000d9d573d6000803e3d6000fd5b50505050505b6000848152602081815260408083208684529091528120558262000dc78162001abe565b9350505062000d12565b50919050565b6000828152602081815260408083208484529091528120548062000e00576000915050620007e1565b60008481526020819052604081208162000e1c86600162001a00565b8152602001908152602001600020541462000e3c576000915050620007e1565b62000e478162000f5e565b62000ea8576000819050806001600160a01b0316632b68b9c66040518163ffffffff1660e01b8152600401600060405180830381600087803b15801562000e8d57600080fd5b505af115801562000ea2573d6000803e3d6000fd5b50505050505b5050600091825260208281526040808420928452919052812055600190565b60008281526020818152604080832084845290915281205481908062000ef557600080925092505062000728565b62000f008162000f5e565b1562000f1357600062000c918260e01c90565b8062000cac8162001027565b6000805b6000838152602081815260408083208484529091529020548062000f485750620007e1565b8162000f548162001abe565b9250505062000f23565b60008062000f6c8360e01c90565b1192915050565b600080600062000f8385620014b4565b808652909350905083601c8411156200101957601c81016000805b6020600162000faf601c8a62001a3e565b62000fbc90602062001a00565b62000fc8919062001a3e565b62000fd4919062001a1b565b8110156200101557600081815260208b8152604090912054808552925062000ffe90849062001a00565b9250806200100c8162001abe565b91505062000f9e565b5050505b600192505050935093915050565b6000806001600160a01b0383166200104457506000928392509050565b600080604051806101600160405280610126815260200162001c306101269139519050843b91508082101562001081575060009485945092505050565b6200108d818362001a3e565b95600195509350505050565b600080600080620010aa8662001027565b9150915080620010c35760008093509350505062000728565b6000604051806101600160405280610126815260200162001c306101269139519050828187893c509095600195509350505050565b6000828152602081815260408083208484529091529020548062001194578115806200114d57506000838152602081905260408120816200113b60018662001a3e565b81526020019081526020016000205414155b620011945760405162461bcd60e51b81526020600482015260166024820152751b5d5cdd081c995c1b1858d9481bdc88185c1c195b9960521b604482015260640162000651565b6200119f8162000f5e565b6200067157806001600160a01b038116156200082a57806001600160a01b0316632b68b9c66040518163ffffffff1660e01b8152600401600060405180830381600087803b158015620011f157600080fd5b505af115801562001206573d6000803e3d6000fd5b5050505050505050565b600080604051806101600160405280610126815260200162001c3061012691398585604051602001620012469392919062001946565b60408051601f1981840301815291905290506000620012686043602062001a00565b308382015290506200127d608c602062001a00565b9050308183015250600083826040516200129790620015ca565b620012a3919062001970565b6040518091039082f0905080158015620012c1573d6000803e3d6000fd5b509695505050505050565b805160208083015160e083901b911c1790601c8111156200136a576000603c8401815b6020600162001300601c8762001a3e565b6200130d90602062001a00565b62001319919062001a3e565b62001325919062001a1b565b8110156200136657815192506200133e82602062001a00565b60008281526020899052604090208490559150806200135d8162001abe565b915050620012ef565b5050505b5092915050565b606060006200138083620014cf565b92509050601c8111156200136a57603c82016000805b60206001620013a7601c8762001a3e565b620013b490602062001a00565b620013c0919062001a3e565b620013cc919062001a1b565b8110156200136657600081815260208881526040909120548085529250620013f690849062001a00565b925080620014048162001abe565b91505062001396565b606060008060006200141f8562001027565b91509150806200143157600062000a07565b60008267ffffffffffffffff8111156200144f576200144f62001b08565b6040519080825280601f01601f1916602001820160405280156200147a576020820181803683370190505b5090506000604051806101600160405280610126815260200162001c306101269139519050838160208401893c5095600195509350505050565b600080620014c28360e01c90565b9360209390931b92915050565b60006060620014de8360e01c90565b9150602083901b92508167ffffffffffffffff81111562001503576200150362001b08565b6040519080825280601f01601f1916602001820160405280156200152e576020820181803683370190505b5060208101939093525091565b828054620015499062001a87565b90600052602060002090601f0160209004810192826200156d5760008555620015b8565b82601f106200158857805160ff1916838001178555620015b8565b82800160010185558215620015b8579182015b82811115620015b85782518255916020019190600101906200159b565b50620015c6929150620015d8565b5090565b6101118062001b1f83390190565b5b80821115620015c65760008155600101620015d9565b60008083601f8401126200160257600080fd5b50813567ffffffffffffffff8111156200161b57600080fd5b6020830191508360208285010111156200072857600080fd5b600082601f8301126200164657600080fd5b813567ffffffffffffffff8082111562001664576200166462001b08565b604051601f8301601f19908116603f011681019082821181831017156200168f576200168f62001b08565b81604052838152866020858801011115620016a957600080fd5b836020870160208301376000602085830101528094505050505092915050565b600060208284031215620016dc57600080fd5b81356001600160a01b03811681146200092157600080fd5b6000602082840312156200170757600080fd5b813567ffffffffffffffff8111156200171f57600080fd5b6200172d8482850162001634565b949350505050565b6000806000604084860312156200174b57600080fd5b833567ffffffffffffffff808211156200176457600080fd5b620017728783880162001634565b945060208601359150808211156200178957600080fd5b506200179886828701620015ef565b9497909650939450505050565b60008060408385031215620017b957600080fd5b823567ffffffffffffffff811115620017d157600080fd5b620017df8582860162001634565b95602094909401359450505050565b600080600080606085870312156200180557600080fd5b843567ffffffffffffffff808211156200181e57600080fd5b6200182c8883890162001634565b95506020870135945060408701359150808211156200184a57600080fd5b506200185987828801620015ef565b95989497509550505050565b600081518084526200187f81602086016020860162001a58565b601f01601f19169290920160200192915050565b828482376000838201600080825280855482600182811c915080831680620018bc57607f831692505b6020808410821415620018dd57634e487b7160e01b87526022600452602487fd5b818015620018f45760018114620019065762001934565b60ff1986168952848901965062001934565b60008c815260209020885b868110156200192c5781548b82015290850190830162001911565b505084890196505b50949c9b505050505050505050505050565b600084516200195a81846020890162001a58565b8201838582376000930192835250909392505050565b60208152600062000921602083018462001865565b6040815260006200199a604083018562001865565b905082151560208301529392505050565b6020808252600f908201526e36bab9ba10333937b69037bbb732b960891b604082015260600190565b60008085851115620019e557600080fd5b83861115620019f357600080fd5b5050820193919092039150565b6000821982111562001a165762001a1662001adc565b500190565b60008262001a3957634e487b7160e01b600052601260045260246000fd5b500490565b60008282101562001a535762001a5362001adc565b500390565b60005b8381101562001a7557818101518382015260200162001a5b565b838111156200082a5750506000910152565b600181811c9082168062001a9c57607f821691505b6020821081141562000dd157634e487b7160e01b600052602260045260246000fd5b600060001982141562001ad55762001ad562001adc565b5060010190565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052604160045260246000fdfe60806040526040516101113803806101118339810160408190526100229161002b565b80518060208301f35b6000602080838503121561003e57600080fd5b82516001600160401b038082111561005557600080fd5b818501915085601f83011261006957600080fd5b81518181111561007b5761007b6100fa565b604051601f8201601f19908116603f011681019083821181831017156100a3576100a36100fa565b8160405282815288868487010111156100bb57600080fd5b600093505b828410156100dd57848401860151818501870152928501926100c0565b828411156100ee5760008684830101525b98975050505050505050565b634e487b7160e01b600052604160045260246000fdfe6080604052348015600f57600080fd5b506004361060325760003560e01c80632b68b9c61460375780638da5cb5b14603f575b600080fd5b603d6081565b005b60657f000000000000000000000000000000000000000000000000000000000000000081565b6040516001600160a01b03909116815260200160405180910390f35b336001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000161460ed5760405162461bcd60e51b815260206004820152600e60248201526d3737ba10333937b69037bbb732b960911b604482015260640160405180910390fd5b33fffea2646970667358221220fc66c9afb7cb2f6209ae28167cf26c6c06f86a82cbe3c56de99027979389a1be64736f6c63430008070033a2646970667358221220ca0d4a60e2298f318fbb2eaa0131ecef56076cb5bfa59ca12f792a7117cba2b064736f6c63430008070033",
   })
);
```

#### Write blog
Get the edited content from markdown, calculate the token that needs to be staked according to the content length, and submit the content on the chain.
```
const content = this.markdownEditor.value();
const fileSize = Buffer.byteLength(content, "utf-8");

const contract = blogContract(this.SimpleBlogAddress);
let cost = 0;
if (fileSize > 24 * 1024 - 326) {
    cost = Math.floor((fileSize + 326) / 1024 / 24);
}
await this._doTx(() => contract.writeBlog(
    stringToHex(this.editingTitle),
    stringToHex(content),
    {value: ethers.utils.parseEther(cost.toString())}
));
```

#### Edit blog
Can re-edit blog posts.
```
const newContent = this.markdownEditor.value();
const fileSize = Buffer.byteLength(newContent, "utf-8");

const contract = blogContract(this.SimpleBlogAddress);
let cost = 0;
if (fileSize > 24 * 1024 - 326) {
    cost = Math.floor((fileSize + 326) / 1024 / 24);
}
await this._doTx(() => contract.editBlog(
    blogId,
    stringToHex(this.editingTitle),
    stringToHex(newContent),
    {value: ethers.utils.parseEther(cost.toString())}
));
```

#### Delete blog
```
const contract = blogContract(this.SimpleBlogAddress);
const idx = parseInt(blodId, 10);
await this._doTx(() => contract.deleteBlog(idx));
```

#### Write comment
```
const content = this.commentText.toString();
const contract = blogContract(this.SimpleBlogAddress);
const idx = parseInt(this.blogId, 10);
await this._doTx(() => contract.writeComment(idx, stringToHex(content)));
```
<br>


### SimpleBlog
SimpleBlog is used to manage user Blogs.

#### Storage structure
```
contract SimpleBlog {
    struct Blog {
        bytes title;
        uint256 timestamp; // 0 means deleted
    }

    struct CommentInfo {
        address contractAddress;
        uint256 commentSize;
    }

    Blog[] public blogs;
    uint256 public blogLength;
    mapping(uint256 => CommentInfo) public commentList; // Each article will have a SimpleComment contract
}
```

#### Register
When the contract is deployed, a flat contract will be generated synchronously to store the blog content.
```
constructor() SimpleFlatDirectory(0) {
    FlatDirectory flat = new FlatDirectory(0);
    flat.changeOwner(msg.sender);
    assets = address(flat);
}
```

#### Write Blog
Every time an article is created, a SimpleComment is generated synchronously to manage the comments of this article.
```
function writeBlog(bytes memory title, bytes memory content) public payable {
        uint256 idx = blogs.length;
        blogs.push(Blog(title, block.timestamp));
        blogLength++;
        write(abi.encodePacked(idx), content);

        CommentsInfo storage info = commentsList[idx];
        SimpleComment comment = new SimpleComment();
        info.contractAddress = address(comment);
}
```

#### Edit Blog
```
function editBlog(uint256 idx, bytes memory newTitle, bytes memory newContent) public payable {
    Blog storage blog = blogs[idx];
    require(blog.timestamp != 0, "non-existent");
    blog.title = newTitle;
    blog.timestamp = block.timestamp;
    write(abi.encodePacked(idx), newContent);
}
```

#### Write Comment
```
function writeComment(uint256 blodId, bytes memory content) public payable {
    CommentInfo storage info = commentList[blodId];
    address contractAddress = info.contractAddress;
    require(contractAddress != address(0), "blog not exist");

    SimpleComment com = SimpleComment(contractAddress);
    com.writeComment(info.commentSize, content);
    com.writeOwner(info.commentSize, msg.sender);
    com.writeTimestamp(info.commentSize, block.timestamp);
    info.commentSize++;
}
```
<br>

### SimpleComment
SimpleComment is used to store blog comments.

#### Write comment content
```
function writeComment(uint256 commentId, bytes memory content) public payable {
    write(abi.encodePacked(commentId, "comment"), content);
}

function writeOwner(uint256 commentId, address owner) public payable {
    write(abi.encodePacked(commentId, "owner"), addressToBytes(owner));
}

function writeTimestamp(uint256 commentId, uint256 timestamp) public payable {
    write(abi.encodePacked(commentId, "timestamp"), uintToBytes(timestamp));
}
```

#### Read comment content
```
function getComment(uint256 commentId) public view returns (bytes memory) {
    return files(abi.encodePacked(commentId, "comment"));
}

function getOwner(uint256 commentId) public view returns (address) {
    bytes memory content = files(abi.encodePacked(commentId, "owner"));
    return bytesToAddress(content);
}

function getTimestamp(uint256 commentId) public view returns (bytes memory) {
    return files(abi.encodePacked(commentId, "timestamp"));
}
```
